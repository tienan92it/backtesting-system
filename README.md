# Backtesting System

An event-driven backtesting framework for cryptocurrency trading strategies.

## System Architecture

```mermaid
flowchart TD
    %% Main Components
    DataHandler["Data Handler"] 
    Strategy["Strategy"]
    Portfolio["Portfolio"]
    Execution["Execution Handler"]
    Backtester["Backtester"]
    EventLoop["Event Loop"]
    
    %% Main Events
    ME[Market Event]
    SE[Signal Event]
    OE[Order Event]
    FE[Fill Event]
    PE[Portfolio Event]

    %% Flow
    Backtester --> DataHandler
    Backtester --> EventLoop
    
    %% Event Flow
    DataHandler -->|produces| ME
    ME -->|processed by| Strategy
    Strategy -->|produces| SE
    SE -->|processed by| Portfolio
    Portfolio -->|produces| OE
    OE -->|processed by| Execution
    Execution -->|produces| FE
    FE -->|processed by| Portfolio
    Portfolio -->|produces| PE
    PE -->|updates| Backtester
    
    %% Event Loop coordination
    EventLoop -.->|manages events| ME
    EventLoop -.->|manages events| SE
    EventLoop -.->|manages events| OE
    EventLoop -.->|manages events| FE
    EventLoop -.->|manages events| PE
    
    %% Styling
    classDef component fill:#6495ED,stroke:#333,stroke-width:1px,color:white;
    classDef event fill:#FF6347,stroke:#333,stroke-width:1px,color:white;
    classDef core fill:#32CD32,stroke:#333,stroke-width:1px,color:white;
    
    class DataHandler,Strategy,Portfolio,Execution component;
    class ME,SE,OE,FE,PE event;
    class EventLoop,Backtester core;
```

## Overview

This backtesting system implements an event-driven architecture for simulating trading strategies on historical cryptocurrency data. The main components include:

- **Data Handler**: Provides market data from Binance or other exchanges via CCXT
- **Strategy**: Analyzes market data and generates trading signals
- **Portfolio**: Tracks positions, cash, and equity over time
- **Execution Handler**: Simulates order execution with commission and slippage
- **Event Loop**: Manages the flow of events through the system
- **Backtester**: Coordinates the components and calculates performance metrics

## Event Types

The system processes several types of events:

1. **Market Events**: New price data from the market
2. **Signal Events**: Buy/sell signals generated by strategies
3. **Order Events**: Orders created from signals
4. **Fill Events**: Executed orders with fill price and commission
5. **Portfolio Events**: Updated portfolio state after fills
